<!doctype html>
<html lang="en-us">
  <head>
    <title>Perl Weekly Challenge 16: Torturing Your Party Guests With The Pythagoreas Pie Puzzle // Yozen Hernandez</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Yozen Hernandez" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.e04f32518dbcdbc64ddad5e1768be6d5edcc5cdba41caea400b8b4cdbc17a452.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Perl Weekly Challenge 16: Torturing Your Party Guests With The Pythagoreas Pie Puzzle"/>
<meta name="twitter:description" content="This week&rsquo;s Perl Weekly Challenge includes a math puzzle known as the Pythagoreas Pie Puzzle. The problem, as stated by challenge proponent Jo Christian Oterhals:
At a party a pie is to be shared by 100 guest. The first guest gets 1% of the pie, the second guest gets 2% of the remaining pie, the third gets 3% of the remaining pie, the fourth gets 4% and so on."/>

    <meta property="og:title" content="Perl Weekly Challenge 16: Torturing Your Party Guests With The Pythagoreas Pie Puzzle" />
<meta property="og:description" content="This week&rsquo;s Perl Weekly Challenge includes a math puzzle known as the Pythagoreas Pie Puzzle. The problem, as stated by challenge proponent Jo Christian Oterhals:
At a party a pie is to be shared by 100 guest. The first guest gets 1% of the pie, the second guest gets 2% of the remaining pie, the third gets 3% of the remaining pie, the fourth gets 4% and so on." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yzhernand.github.io/posts/perl-weekly-challenge-16-1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-12T13:25:46-04:00" />
<meta property="article:modified_time" content="2019-07-12T13:25:46-04:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://yzhernand.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Yozen Hernandez" /></a>
      <span class="app-header-title">Yozen Hernandez</span>
      <p>Bioinformatician who programs in Perl, C, and R. Occasionally writes about things.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/yzhernand" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://fosstodon.org/@yzh" target="_blank" rel="noreferrer noopener me">
            <span class="icon">
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg>
</span>
          </a>
        
          <a href="https://www.linkedin.com/in/yzhernand/" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
          <a href="https://www.researchgate.net/profile/Yoezen_Hernandez" target="_blank" rel="noreferrer noopener me">
            <span class="icon">
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>ResearchGate</title><path d="M19.586 0c-.818 0-1.508.19-2.073.565-.563.377-.97.936-1.213 1.68a3.193 3.193 0 0 0-.112.437 8.365 8.365 0 0 0-.078.53 9 9 0 0 0-.05.727c-.01.282-.013.621-.013 1.016a31.121 31.123 0 0 0 .014 1.017 9 9 0 0 0 .05.727 7.946 7.946 0 0 0 .077.53h-.005a3.334 3.334 0 0 0 .113.438c.245.743.65 1.303 1.214 1.68.565.376 1.256.564 2.075.564.8 0 1.536-.213 2.105-.603.57-.39.94-.916 1.175-1.65.076-.235.135-.558.177-.93a10.9 10.9 0 0 0 .043-1.207v-.82c0-.095-.047-.142-.14-.142h-3.064c-.094 0-.14.047-.14.141v.956c0 .094.046.14.14.14h1.666c.056 0 .084.03.084.086 0 .36 0 .62-.036.865-.038.244-.1.447-.147.606-.108.385-.348.664-.638.876-.29.212-.738.35-1.227.35-.545 0-.901-.15-1.21-.353-.306-.203-.517-.454-.67-.915a3.136 3.136 0 0 1-.147-.762 17.366 17.367 0 0 1-.034-.656c-.01-.26-.014-.572-.014-.939a26.401 26.403 0 0 1 .014-.938 15.821 15.822 0 0 1 .035-.656 3.19 3.19 0 0 1 .148-.76 1.89 1.89 0 0 1 .742-1.01c.344-.244.593-.352 1.137-.352.508 0 .815.096 1.144.303.33.207.528.492.764.925.047.094.111.118.198.07l1.044-.43c.075-.048.09-.115.042-.199a3.549 3.549 0 0 0-.466-.742 3 3 0 0 0-.679-.607 3.313 3.313 0 0 0-.903-.41A4.068 4.068 0 0 0 19.586 0zM8.217 5.836c-1.69 0-3.036.086-4.297.086-1.146 0-2.291 0-3.007-.029v.831l1.088.2c.744.144 1.174.488 1.174 2.264v11.288c0 1.777-.43 2.12-1.174 2.263l-1.088.2v.832c.773-.029 2.12-.086 3.465-.086 1.29 0 2.951.057 3.667.086v-.831l-1.49-.2c-.773-.115-1.174-.487-1.174-2.264v-4.784c.688.057 1.29.057 2.206.057 1.748 3.123 3.41 5.472 4.355 6.56.86 1.032 2.177 1.691 3.839 1.691.487 0 1.003-.086 1.318-.23v-.744c-1.031 0-2.063-.716-2.808-1.518-1.26-1.376-2.95-3.582-4.355-6.074 2.32-.545 4.04-2.722 4.04-4.9 0-3.208-2.492-4.698-5.758-4.698zm-.515 1.29c2.406 0 3.839 1.26 3.839 3.552 0 2.263-1.547 3.782-4.097 3.782-.974 0-1.404-.03-2.063-.086v-7.19c.66-.059 1.547-.059 2.32-.059z"/></svg>
</span>
          </a>
        
          <a href="https://orcid.org/0000-0003-3349-8856" target="_blank" rel="noreferrer noopener me">
            <span class="icon">
  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>ORCID</title><path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zM7.369 4.378c.525 0 .947.431.947.947s-.422.947-.947.947a.95.95 0 0 1-.947-.947c0-.525.422-.947.947-.947zm-.722 3.038h1.444v10.041H6.647V7.416zm3.562 0h3.9c3.712 0 5.344 2.653 5.344 5.025 0 2.578-2.016 5.025-5.325 5.025h-3.919V7.416zm1.444 1.303v7.444h2.297c3.272 0 4.022-2.484 4.022-3.722 0-2.016-1.284-3.722-4.097-3.722h-2.222z"/></svg>
</span>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Perl Weekly Challenge 16: Torturing Your Party Guests With The Pythagoreas Pie Puzzle</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jul 12, 2019
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          5 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>This week&rsquo;s <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-016/">Perl Weekly Challenge</a> includes a math puzzle known as the <em>Pythagoreas Pie Puzzle</em>. The problem, as stated by challenge proponent Jo Christian Oterhals:</p>
<blockquote>
<p>At a party a pie is to be shared by 100 guest. The first guest gets 1% of the pie, the second guest gets 2% of the remaining pie, the third gets 3% of the remaining pie, the fourth gets 4% and so on.</p>
<p>Write a script that figures out which guest gets the largest piece of pie.</p>
</blockquote>
<p>Let&rsquo;s take a look at what happens for the first few guests when time they come to take a slice of the pie. The table below shows the calculation made for each guest:</p>
<table>
<thead>
<tr>
<th style="text-align:right">Guest (index)</th>
<th style="text-align:right">Portion</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">(0.01*100)</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">(0.02*99)</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">(0.03*97.02)</td>
</tr>
<tr>
<td style="text-align:right">&hellip;</td>
<td style="text-align:right">&hellip;</td>
</tr>
</tbody>
</table>
<p>There&rsquo;s clearly a pattern there:</p>
<ul>
<li>Each guest is getting a fixed percentage of the <em>remaining</em> pie</li>
<li>The fixed percentage is dependent on the guest&rsquo;s &ldquo;index&rdquo;</li>
<li>The calculation of that depends on the index of the guest and the remaining pie when they came along.</li>
</ul>
<p>So each guest has to do something like:</p>
<p>$$(i/100)R$$</p>
<p>where \(i\) is the index of the guest and \(R\) is how much pie is remaining, to calculate how much they get. Given the table and the points noted above, it becomes clear that the way we get \(R\) is just by going back to the calculation made by the guest before, all the way back to the first one:</p>
<p>$$\begin{align}
100 \times \frac{99}{100} &amp; \quad \text{First guest} \newline
100 \times \frac{99}{100} \times \frac{98}{100} &amp; \quad \text{Second guest} \newline
100 \times \frac{99}{100} \times \frac{98}{100} \times \frac{97}{100} &amp; \quad \text{Third guest} \newline
\vdots \newline
\end{align}$$</p>
<p>Why \(\frac{99}{100}\) and not \(\frac{1}{100}\), and so on, in the equations above? Because the next guest needs to know how much of the pie is <strong>left</strong>, not how much the guest before them took. The first guest left behind (99/100) of 100% of the pie. The next guest left behind 98/100 of that. And so on.</p>
<p>This problem can be considered as a <a href="https://en.wikipedia.org/wiki/Multiplication#Capital_Pi_notation">product of a sequence</a>, with a general formula of</p>
<p>$$\prod_{i=1}^{99} {\frac{(100-i)}{100}}$$</p>
<p>We can start at \(i=1\) and not \(i=0\) because that is just a multiplication by 1. We also don&rsquo;t go to 100 since after the last guest nothing is left (\(\frac{100-100}{100} = 0\)). If the upper limit were 3, we would get the amount of pie remaining after 3 guests</p>
<p>$$\begin{align}
\prod_{i=1}^{3} {\frac{(100-i)}{100}} &amp;= \frac{99}{100} \times \frac{98}{100} \times \frac{97}{100}\newline
&amp;= 0.941094\newline
\end{align}$$</p>
<p>The first iteration of my code used this observation, keeping a list of the amount of pie left after each guest. The next value, \(i\), in the list is calculated simply by multiplying the last element in the array by \(\frac{100-i}{100}\) since that value is already the product of all prior multiplications up to that point. Then I would take the difference between the sizes of the remaining pie after the current guest and the guest before:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">list_pie_remaining</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Other guests get a percent of the remaining 99/100:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 99/100*(2/100) for the second, leaving (99/100)*(98/100)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># for the third guest, and so on...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># So lets just generate a list with the amount of pie left</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># for each guest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">my</span> @remaining_pie <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># my @pie_shares = (1/100);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">my</span> %largest_piece <span style="color:#f92672">=</span> ( guest <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, size <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span> );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">my</span> $i ( <span style="color:#ae81ff">1</span> <span style="color:#f92672">..</span> <span style="color:#ae81ff">99</span> ) {
</span></span><span style="display:flex;"><span>        push @remaining_pie, ( ( <span style="color:#ae81ff">100</span> <span style="color:#f92672">-</span> $i ) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span> ) <span style="color:#f92672">*</span> $remaining_pie[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ( ( $remaining_pie[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> $remaining_pie[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] ) <span style="color:#f92672">&gt;</span> $largest_piece{size} )
</span></span><span style="display:flex;"><span>            ? @largest_piece{ <span style="color:#e6db74">&#34;guest&#34;</span>, <span style="color:#e6db74">&#34;size&#34;</span> }
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">=</span> ( $i, $remaining_pie[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> $remaining_pie[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] )
</span></span><span style="display:flex;"><span>            : <span style="color:#66d9ef">next</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># push @pie_pieces, $remaining_pie[-2]-$remaining_pie[-1];</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">\</span>%largest_piece;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I kept a hash with the largest piece seen so far, which is returned as a hashref.</p>
<p>It turns out, however, that the shares each guest gets are actually getting larger right up until a certain point, as shown in the graph below:</p>
<!-- raw HTML omitted -->
<p>Which means that we only really need to keep track of values for the pie share right up until the share sizes start to decrease, halting execution much sooner than in my first try at this. <strong>Late spoiler alert</strong>: it helps if you already knew the answer ahead of time, but the largest slice is taken by the 10th guest, so we save needless calculations over the next 90 guests!</p>
<p>Another change we could make is that we don&rsquo;t need to maintin a list of all prior values. You could just keep track of the last piece and the pie remaining:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">track_last_piece</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">my</span> $remaining_pie <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">my</span> $last_piece    <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">my</span> $i ( <span style="color:#ae81ff">1</span> <span style="color:#f92672">..</span> <span style="color:#ae81ff">100</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">my</span> $new_piece
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">=</span> $remaining_pie <span style="color:#f92672">-</span> ( ( <span style="color:#ae81ff">100</span> <span style="color:#f92672">-</span> $i ) <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span> ) <span style="color:#f92672">*</span> $remaining_pie;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( $new_piece <span style="color:#f92672">&lt;</span> $last_piece ) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> { guest <span style="color:#f92672">=&gt;</span> ( $i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> ), size <span style="color:#f92672">=&gt;</span> $last_piece };
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        $last_piece <span style="color:#f92672">=</span> $new_piece;
</span></span><span style="display:flex;"><span>        $remaining_pie <span style="color:#f92672">-=</span> $new_piece;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> undef;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Obviously, I won&rsquo;t claim that this is the best solution, but the best I came up with, in the time I had. I took a page out of <a href="http://tilde.town/~wlsn/pwc015.html">Steven Wilson&rsquo;s</a> book and used <a href="https://metacpan.org/pod/Benchmark::Forking">Benchmark::Forking</a> as he details in his awesome blog post on last week&rsquo;s challenge. Below are the results I got when comparing the two methods:</p>
<pre tabindex="0"><code>                        Rate list_pie_remaining   track_last_share
 list_pie_remaining  43203/s                 --               -88%
 track_last_piece   368816/s               754%                 --
</code></pre><p>Obviously a dramatic improvement, which almost certainly leaves room for improvement.</p>
<p>See the full solution, <a href="https://github.com/manwar/perlweeklychallenge-club/tree/master/challenge-016/yozen-hernandez/perl5/ch-1.pl">here</a>.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
